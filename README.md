# SSH Password Interceptor

Библиотека для перехвата паролей и SSH-ключей через инъекцию библиотеки с помощью LD_PRELOAD.

## Описание

SSH Password Interceptor позволяет перехватывать пароли и приватные ключи, используемые при SSH-подключениях, через механизм LD_PRELOAD для перехвата системных вызовов. Библиотека использует:

1. Машину состояний для определения момента ввода пароля и его захвата
2. Перехват файловых операций для обнаружения доступа к SSH-ключам

Перехваченные пароли сохраняются в лог-файл `/tmp/ssh_inj.dbg`, а SSH-ключи в `/tmp/ssh_keys.log` вместе с дополнительной информацией.

## Функции

* Перехват паролей SSH-клиента
* Перехват SSH-ключей при их использовании
* Отслеживание успешных и неуспешных попыток аутентификации
* Сохранение информации о пользователе, командной строке и времени
* Логирование в защищенные файлы

## Новые возможности!

* **Перехват SSH-ключей**: Теперь библиотека может перехватывать приватные SSH-ключи из файлов
* **Обнаружение различных форматов**: Работает с ключами в форматах OpenSSH, PEM, PPK
* **Отдельный лог-файл**: Все перехваченные ключи сохраняются в отдельный файл `/tmp/ssh_keys.log`

## Системные требования

* Linux-система
* Компилятор g++
* Библиотека libdl
* Права администратора для установки

## Быстрая установка

```bash
# Перейдите в директорию с распакованными файлами
cd ssh_inject

# Установка с помощью скрипта (требуются права root)
sudo ./installer.sh
```

## Ручная установка

### Компиляция

```bash
# Перейдите в директорию с исходными файлами
cd ssh_inject

# Запустите скрипт компиляции
sudo ./compile.sh
```

### Использование

```bash
# Локальное использование
LD_PRELOAD=./libssh_inject.so ssh user@server

# Или если библиотека установлена в системную директорию
LD_PRELOAD=/usr/lib/libssh_inject.so ssh user@server
```

## Структура файлов

* `state.hpp` - Реализация машины состояний для перехвата паролей
* `key_interceptor.hpp` - Класс для перехвата SSH-ключей
* `ssh_inject.cpp` - Основной код для перехвата системных вызовов
* `compile.sh` - Скрипт для компиляции библиотеки
* `installer.sh` - Скрипт для установки библиотеки в систему
* `uninstall.sh` - Скрипт для удаления библиотеки из системы

## Системная установка

Для автоматической загрузки библиотеки для всех вызовов SSH, можно добавить путь к библиотеке в файл `/etc/ld.so.preload`. Это автоматически сделает скрипт `installer.sh` при выборе соответствующей опции.

**ВАЖНО:** Использование `/etc/ld.so.preload` влияет на работу всей системы. Используйте с осторожностью.

## Удаление

```bash
# Удаление с помощью скрипта
sudo ./uninstall.sh
```

Скрипт удалит библиотеку из системы и очистит все записи в `/etc/ld.so.preload`.

## Просмотр логов

```bash
# Просмотр перехваченных паролей
cat /tmp/ssh_inj.dbg

# Просмотр перехваченных SSH-ключей
cat /tmp/ssh_keys.log
```

## Ограничения

* Работает только на Linux-системах
* Может конфликтовать с другими библиотеками, использующими LD_PRELOAD
* Требует прав администратора для установки в систему
* Для перехвата SSH-ключей файлы ключей должны быть доступны для чтения

## Вопросы безопасности

**ВНИМАНИЕ:** Данный инструмент предназначен только для образовательных целей и тестирования систем безопасности. Использование данного инструмента для несанкционированного доступа к чужим системам или данным является незаконным.

## Техническая информация

Библиотека работает за счет перехвата следующих системных вызовов:
* `strlen` - для определения момента ввода пароля
* `sigaction` - для обнаружения подготовки к приему пароля (SIGTTOU)
* `open`, `fopen` - для перехвата операций с файлами SSH-ключей
* `exit` - для обработки завершения программы

## Лицензия

Данное программное обеспечение распространяется под лицензией MIT.

## Автор

Этот проект разработан для образовательных целей и тестирования систем безопасности. 